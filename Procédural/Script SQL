DROP DATABASE dendo_jitensha;
CREATE DATABASE dendo_jitensha;
CREATE TABLE Users(
   id_user INT NOT NULL AUTO_INCREMENT,
   lastname VARCHAR(50) NOT NULL,
   firstname VARCHAR(50) NOT NULL,
   mail_address VARCHAR(100) NOT NULL UNIQUE,
   password VARCHAR(255) NOT NULL,
   profil_picture VARCHAR(255),
   date_created_user DATETIME,
   date_modified_user DATETIME,
   PRIMARY KEY(id_user)
);

CREATE TABLE Addresses(
   id_user INT NOT NULL AUTO_INCREMENT,
   id_address INT,
   number VARCHAR(10),
   street VARCHAR(100),
   city VARCHAR(50),
   postal_code VARCHAR(10),
   PRIMARY KEY(id_user, id_address),
   FOREIGN KEY(id_user) REFERENCES Users(id_user)
);

CREATE TABLE Type_of_product(
   id_type_product INT NOT NULL AUTO_INCREMENT,
   type_product VARCHAR(50) NOT NULL,
   PRIMARY KEY(id_type_product)
);

CREATE TABLE Orders(
   id_user INT,
   id_order INT NOT NULL AUTO_INCREMENT,
   order_status VARCHAR(50) NOT NULL,
   date_created_order DATETIME NOT NULL,
   date_modified_order DATETIME,
   amount_order DECIMAL(8,2),
   numberadress_order VARCHAR(5),
   streetadress_order VARCHAR(50),
   cityadress_order VARCHAR(30),
   postalcode_order VARCHAR(10),
   firstname_bill VARCHAR(50),
   lastname_bill VARCHAR(50),
   adress_bill VARCHAR(100),
   amount_bill DECIMAL(10,2),
   PRIMARY KEY(id_user, id_order),
   FOREIGN KEY(id_user) REFERENCES Users(id_user)
);

CREATE TABLE Carts(
   id_user INT,
   id_cart INT NOT NULL AUTO_INCREMENT,
   total_price DECIMAL(8,2) NOT NULL,
   PRIMARY KEY(id_user, id_cart),
   FOREIGN KEY(id_user) REFERENCES Users(id_user)
);

CREATE TABLE Payments(
   id_user INT,
   id_order INT,
   id_payment INT NOT NULL AUTO_INCREMENT,
   date_payment VARCHAR(50),
   date_created_payment DATETIME NOT NULL,
   amount_payment INT NOT NULL,
   payment_status VARCHAR(50),
   PRIMARY KEY(id_user, id_order, id_payment),
   FOREIGN KEY(id_user, id_order) REFERENCES Orders(id_user, id_order)
);

CREATE TABLE Products(
   id_type_product INT,
   id_product INT NOT NULL AUTO_INCREMENT,
   name_product VARCHAR(50) NOT NULL,
   description_product VARCHAR(100),
   autonomy VARCHAR(20),
   motor VARCHAR(20),
   battery VARCHAR(20),
   price_product DECIMAL(8,2) NOT NULL,
   picture_product VARCHAR(255),
   date_created_product DATETIME,
   date_modifed_product DATETIME,
   brand VARCHAR(50),
   stock INT,
   PRIMARY KEY(id_type_product, id_product),
   FOREIGN KEY(id_type_product) REFERENCES Type_of_product(id_type_product)
);

CREATE TABLE Favorites(
   id_type_product INT,
   id_product INT,
   id_favorite INT NOT NULL AUTO_INCREMENT,
   favorite BOOLEAN,
   PRIMARY KEY(id_type_product, id_product, id_favorite),
   FOREIGN KEY(id_type_product, id_product) REFERENCES Products_(id_type_product, id_product)
);

CREATE TABLE Orders_lines(
   id_user INT,
   id_order INT,
   id_order_line INT NOT NULL AUTO_INCREMENT,
   date_created_order_line DATETIME,
   date_modifed_order_line DATETIME,
   id_type_product INT,
   id_product INT,
   PRIMARY KEY(id_user, id_order, id_order_line),
   FOREIGN KEY(id_user, id_order) REFERENCES Orders(id_user, id_order),
   FOREIGN KEY(id_type_product, id_product) REFERENCES Products_(id_type_product, id_product)
);

CREATE TABLE Cart_lines(
   id_type_product INT,
   id_product INT,
   id_user INT,
   id_cart INT,
   id_cart_line INT NOT NULL AUTO_INCREMENT,
   date_created_cart_line DATETIME,
   date_modified_cart_line DATETIME,
   PRIMARY KEY(id_type_product, id_product, id_user, id_cart, id_cart_line),
   FOREIGN KEY(id_type_product, id_product) REFERENCES Products_(id_type_product, id_product),
   FOREIGN KEY(id_user, id_cart) REFERENCES Carts_(id_user, id_cart)
);

CREATE TABLE peut_avoir(
   id_user INT,
   id_type_product INT,
   id_product INT,
   id_favorite INT,
   PRIMARY KEY(id_user, id_type_product, id_product, id_favorite),
   FOREIGN KEY(id_user) REFERENCES Users(id_user),
   FOREIGN KEY(id_type_product, id_product, id_favorite) REFERENCES Favorites_(id_type_product, id_product, id_favorite)
);
